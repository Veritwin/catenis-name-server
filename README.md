# Catenis Name Server

This is an implementation of the Catenis Name Service, which is used by Catenis nodes to map their IPFS root repository
 CID to a hostname so other Catenis nodes can reference it.
 
## The Catenis Name Service 

Catenis Name Service serves as a workaround for IPFS' IPNS, which currently does not meet Catenis' performance needs;
 it takes too long to publish a new name.

## How it works

Catenis Name Server provides a REST API though which Catenis nodes can reset their own IPFS root repository CID
 and query for the IPFS root repository CID of other Catenis nodes.

## REST API

### Authentication

The requests to the Catenis Name Server REST API should be authenticated using the [HTTP Signature](https://github.com/joyent/node-http-signature)
 scheme.
 
Each Catenis node should be assigned an SSH RSA key pair for signing the HTTP requests. Use the following command to
 generate such key pair.

```shell
ssh-keygen -b 2048 -t rsa -m PEM -f ctn-node0_key
```

Catenis Name Server expects to retrieve Catenis nodes' public keys from *catenis.io*'s DNS by looking up TXT records
 associated with the ***ctn-node*** subdomain. Such TXT records should contain a JSON with the following keys:
- idx: \[Integer\] The Catenis node index.
- pubKey: \[String\] The SSH RSA public key.

The following is an example of such TXT record:

```text
ctn-node TXT {"idx":0,"pubKey":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC2q/4V67+BMRrVIZGWLWc27B80kMc/NlJGSXbs2KuN4bmK4iyPA0ycTxavrb1y9eFIXg/ZM613DpeEsK7uaU9wtRZxaI1hFY3oWiEx28gU8Jh4XnBHgSNl4LibAKZIiOtiHOAqCAYUpQuU+j8Kr4GNKzP+QuuwQbOkEpImwv01Mpq+lUpqyvhL0GqMfQNaYvSjV02OZtRcHqQ1CfIuWxfs+iAht1WrW6C4+KZsaRbmZG63ujmvLIwG7zdV3y5NW9NUdoJTM59EHHOQ5yFn985C8Q5QUwnk544TZsMJJ4szVELWSzlrzGFpZfCygkEJmAJVAq+KRBQe/4z6PDfX1qIR"}
```

> **Note**: the client ID —in the format *&lt;username>@&lt;host-name>*— at the end of the public key file generated by
 the `ssh-keygen` command should not be included when setting the value of the `pubKey` key.  

### Set IPFS Root Repository CID method

Request: `POST /ctn-node/:nodeIdx/ipfs-root`

URL parameters:
- nodeIdx: the index of the Catenis node for which the IPFS root repository CID should be set

Request body: a JSON containing the following keys:
- `cid`: \[String\] New IPFS CID of Catenis node's IPFS root repository.

Success response body: a JSON containing the following keys:
- `status`: \[String\] The value **'success'**.

### Retrieve IPFS Root Repository CID method

Request: `GET /ctn-node/:nodeIdx/ipfs-root`

URL parameters:
- `nodeIdx`: the index of the Catenis node for which the IPFS root repository CID should be retrieved.

Success response body: a JSON containing the following keys:
- `status`: \[String\] The value **'success'**.
- `data.cid`: \[String\] The current IPFS CID of Catenis node's IPFS root repository.